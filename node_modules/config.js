'use strict'
var ipc = require('electron').ipcRenderer,
  callBack = null,
  isWriting = false

ipc.on('save-config-success', function (e) {
  callBack && callBack()
  isWriting = false
})

ipc.on('save-config-fail', function (e, d) {
  alert('save fail')
  isWriting = false
})

var configData = (function () {
  var data = null
  
  return {
    init: function (jsonString) {
      if (!jsonString) {
        data = {"leftBar":[{"name":"构建功能","initData":"build"},{"name":"文件压缩","initData":"uglify"},{"name":"移动端调试","initData":"mobile-debug"},{"name":"辅助功能","initData":"other"}],"build":[{"name":"新版首页/整站头部 CSS","desc":"压缩新老头部CSS，首页相关CSS","cwd":"D:/work/svn/yixun_test_proj/webapp/st_icson_com/static_v1/css/build","cmd":"gulp"},{"name":"新版首页/整站头部 JS","desc":"压缩新老头部JS，首页相关JS","cwd":"D:/work/svn/yixun_test_proj/webapp/st_icson_com/static_v1/js/build","cmd":"gulp"},{"name":"M站压缩合并JS","desc":"使用r.js对require模块压缩合并","cwd":"D:/work/svn/yixun_test_proj/webapp/st_icson_com/touch_v1","cmd":"node r.js -o build.js"},{"name":"商详页JS压缩合并","desc":"使用ant对模块进行压缩合并","cwd":"D:/work/svn/itemdetail_proj/icson/detail/js/itemdetail/page","cmd":"ant"}],"mobile-debug":{"ip":"10.9.215.45","port":"8888"}}
      } else {
        data = JSON.parse(jsonString)
      }
      return data
    },
    getData: function () {
      return data
    },
    setData: function (channel, d, cb) {
      if (isWriting) {return}
      data[channel] = d
      var str = JSON.stringify(data)
      ipc.send('write-config', str)
      callBack = cb
      isWriting = true
    }
  }
}())

module.exports = configData
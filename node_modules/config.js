'use strict'
var ipc = require('electron').ipcRenderer,
  callBack = null,
  isWriting = false

ipc.on('save-config-success', function (e) {
  callBack && callBack()
  isWriting = false
})

ipc.on('save-config-fail', function (e, d) {
  alert('save fail')
  isWriting = false
})

var configData = (function () {
  var data = null
  
  return {
    init: function (jsonString) {
      data = JSON.parse(jsonString)
      return data
    },
    getData: function () {
      return data
    },
    setData: function (channel, d, cb) {
      if (isWriting) {return}
      data[channel] = d
      var str = JSON.stringify(data)
      ipc.send('write-config', str)
      callBack = cb
      isWriting = true
    }
  }
}())

module.exports = configData